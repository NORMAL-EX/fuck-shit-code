# 🌸 fuck-shit-code - 屎山代码检测器

[English](./README_en.md) | 简体中文

## 📖 简介

`fuck-shit-code` 是一个专为挖掘"屎山代码"设计的工具，能无情揭露代码的丑陋真相，并用毫不留情的幽默语言告诉你：你的代码到底有多烂。

这是原版 Go 语言实现 `fuck-u-code` 的 Rust 重写版本，保持了所有功能的完整性，同时提供了更好的性能和内存安全性。

## ✨ 特性

- 🔍 **多语言支持** - 支持 Rust、Go、JavaScript、TypeScript、Python、Java、C/C++、C#、**PHP、HTML、CSS** 等主流编程语言
- 📊 **7大质量指标** - 循环复杂度、状态管理、注释覆盖率、错误处理、命名规范、代码重复度、代码结构
- 🌏 **国际化** - 支持中文和英文界面
- 📈 **详细报告** - 提供控制台彩色输出和 Markdown 格式报告
- 🚀 **高性能** - 使用 Rust 并行处理，快速分析大型代码库
- 🎯 **智能排除** - 自动排除 node_modules、target、vendor 等依赖目录
- 📱 **进度显示** - 实时显示分析进度
- 🌱 **无文件项目支持** - **支持检测无代码文件的空项目文件夹**
- 🎨 **前端文件支持** - **完整支持HTML/CSS/JS文件质量检测**

## 🛠️ 安装

### 从源码编译

需要先安装 Rust 工具链：

```bash
# 安装 Rust (如果未安装)
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

# 克隆仓库
git clone https://github.com/NORMAL-EX/fuck-shit-code.git
cd fuck-shit-code

# 编译发布版本
cargo build --release

# 安装到系统
cargo install --path .
```

### 使用 Cargo 安装

```bash
cargo install fuck-shit-code
```

## 📋 使用方法

### 基本用法

```bash
# 分析当前目录
fuck-shit-code .

# 分析指定目录
fuck-shit-code /path/to/your/project

# 分析单个文件
fuck-shit-code src/main.rs

# 分析空项目文件夹（无代码文件也会给出分析报告）
fuck-shit-code ./empty-project

# 分析前端项目
fuck-shit-code ./my-website
```

### 支持的文件类型

#### 后端语言
- **Rust** (.rs)
- **Go** (.go)
- **Python** (.py, .pyw)
- **Java** (.java)
- **C/C++** (.c, .h, .cpp, .cc, .cxx, .hpp, .h++)
- **C#** (.cs, .razor)
- **PHP** (.php, .php3, .php4, .php5, .php7, .php8, .phtml)

#### 前端语言
- **JavaScript** (.js, .mjs, .cjs)
- **TypeScript** (.ts, .tsx, .jsx)
- **HTML** (.html, .htm, .xhtml)
- **CSS** (.css, .scss, .sass, .less)

### 命令行选项

```bash
fuck-shit-code [选项] [路径]

选项：
  -l, --lang <LANG>        指定输出语言 (zh-CN, en-US) [默认: zh-CN]
  -v, --verbose            显示详细分析报告
  -t, --top <NUM>          显示问题最多的文件数量 [默认: 5]
  -i, --issues <NUM>       每个文件显示的问题数量 [默认: 5]
  -s, --summary            只看结论，过程略过
  -m, --markdown           输出Markdown格式的精简报告
  -e, --exclude <PATTERN>  排除的文件/目录模式 (可多次使用)
  -x, --skipindex          跳过所有 index.js/index.ts 文件
  -h, --help               显示帮助信息
  -V, --version            显示版本信息
```

### 使用示例

```bash
# 显示详细报告
fuck-shit-code -v ./src

# 输出英文报告
fuck-shit-code -l en-US ./src

# 生成 Markdown 报告
fuck-shit-code -m ./src > report.md

# 排除测试文件
fuck-shit-code -e "**/*_test.rs" -e "**/tests/**" ./src

# 显示前10个问题文件
fuck-shit-code -t 10 ./src

# 只看总结，跳过详细信息
fuck-shit-code -s ./src

# 分析PHP项目
fuck-shit-code ./my-php-project

# 分析前端项目（包含HTML/CSS/JS）
fuck-shit-code ./my-website

# 分析混合项目
fuck-shit-code ./full-stack-project
```

## 📊 质量指标说明

### 1. 循环复杂度 (权重: 30%)
测量函数的控制流复杂度，复杂度越高，代码越难理解和测试。
- **支持所有语言**：准确检测if/else/for/while/switch等控制结构
- **PHP特色**：支持foreach、elseif等PHP特有语法
- **前端特色**：检测DOM操作、事件处理的复杂度

### 2. 状态管理 (权重: 20%)
检测代码中状态变量的管理，良好的状态管理能提高代码可维护性和可预测性。
- **后端语言**：检测全局变量、静态变量使用
- **前端语言**：检测全局状态、DOM状态管理

### 3. 注释覆盖率 (权重: 15%)
检测代码的注释覆盖率，良好的注释能提高代码可读性和可维护性。
- **支持多种注释格式**：//、/* */、#、<!-- -->等
- **文档注释**：支持PHPDoc、JSDoc等文档注释检测

### 4. 代码重复度 (权重: 15%)
评估代码中重复逻辑的比例，重复代码越多，越需要抽象和重构。
- **智能检测**：不仅检测字面重复，还检测结构相似的代码
- **跨文件检测**：检测项目内的重复模式

### 5. 代码结构 (权重: 15%)
检测代码的嵌套深度和引用复杂度，评估结构清晰度。
- **HTML结构**：检测DOM嵌套深度、表单复杂度
- **CSS结构**：检测选择器复杂度、规则嵌套

### 6. 错误处理 (权重: 10%)
检测代码中的错误处理情况，良好的错误处理能提高代码的健壮性。
- **语言特定**：支持各语言的错误处理机制
- **前端特色**：检测try-catch、Promise错误处理

### 7. 命名规范 (权重: 8%)
检测代码中的命名规范，良好的命名能提高代码可读性。
- **多语言规范**：支持各语言的命名约定
- **前端规范**：检测CSS类名、HTML ID的规范性

## 🏆 质量等级

| 分数范围 | 等级 | 说明 |
|---------|------|------|
| 0-5 | 🌱 清新可人 | 代码洁净，令人赏心悦目 |
| 5-15 | 🌸 偶有异味 | 基本没事，但是有伤风化 |
| 15-25 | 😐 微臭青年 | 略有异味，建议适量通风 |
| 25-40 | 😷 屎气扑鼻 | 代码开始散发气味，谨慎维护 |
| 40-55 | 💩 中度屎山 | 臭味明显，开窗也救不了 |
| 55-65 | 🤕 隐性毒瘤 | 写的时候爽，改的时候哭 |
| 65-75 | ☣️ 重度屎山 | 毒气弥漫，建议戴防毒面具 |
| 75-85 | 🧟 代码化尸场 | 进去的程序员没有一个活着出来 |
| 85-95 | ☢️ 核平级灾难 | 反人类罪行，建议火化 |
| 95-100 | 🪦 祖传老屎 | 历代工程师共创的遗产，无法维护 |
| 100 | 👑💩 终极屎王 | 写的时候热血澎湃，改的时候亲妈不认 |

## 🎯 默认排除的文件/目录

工具会自动排除以下常见的依赖和生成目录：

### 前端项目
- `**/node_modules/**` - Node.js 依赖
- `**/dist/**`, `**/build/**` - 前端构建输出
- `**/.next/**`, `**/.nuxt/**` - 框架构建目录
- `**/*.min.js`, `**/*.min.css` - 压缩文件
- `**/*.bundle.js`, `**/*.chunk.js` - 打包文件

### 后端项目
- `**/target/**` - Rust/Java 构建目录
- `**/vendor/**` - Go/PHP 依赖
- `**/__pycache__/**`, `**/venv/**` - Python 相关
- `**/composer.lock`, `**/Cargo.lock` - 依赖锁文件

### 通用排除
- `**/.git/**`, `**/.vscode/**`, `**/.idea/**` - 版本控制和IDE配置
- `**/*_test.*`, `**/test/**`, `**/tests/**` - 测试文件
- `**/logs/**`, `**/tmp/**`, `**/temp/**` - 临时文件

## 📝 输出示例

### 空项目检测
```
🔍 开始嗅探：./empty-project

  ╔════════════════════════════════════════╗
  ║       🏜️  荒芜代码检测器  🏜️         ║
  ╚════════════════════════════════════════╝

  😅 检测到一片荒芜...
  📭 这里空空如也，连一行代码都没有！

  建议：
  1. 🎯 快去写点代码吧，不然我没东西可以吐槽了
  2. 💡 或者检查一下路径是否正确？
  3. 🤔 也可能是排除规则太严格了？

  💭 记住：空的项目是最干净的，但也是最没用的！
```

### 前端项目检测
```
🔍 开始嗅探：./my-website
📂 已找到文件数: 28 (包含 HTML: 5, CSS: 8, JS: 12, PHP: 3)

  🌸 屎山代码分析报告 🌸
─────────────────────────────

  总体评分: 42.31 / 100 - 代码开始散发气味，谨慎维护
  屎山等级: 中度屎山 - 臭味明显，开窗也救不了

◆ 评分指标详情

  ✓  循环复杂度      18.45分   结构基本清晰，偶有绕弯
  •  状态管理        35.20分   DOM状态管理需要改进
  ⚠  注释覆盖率      58.73分   前端代码注释不足
  !  代码重复度      61.22分   CSS选择器有重复模式
  !! HTML结构       72.18分   嵌套层级过深，需要优化
  !! CSS复杂度      68.91分   选择器过于复杂

◆ 最屎代码排行榜

  1. styles/main.css (屎气指数: 78.45)
     CSS选择器复杂度过高，嵌套层级达到8层
     发现19个重复的样式规则
     
  2. js/app.js (屎气指数: 71.23)
     函数 'handleUserInteraction' 复杂度过高 (23)
     全局变量使用过多，状态管理混乱
     
  3. index.html (屎气指数: 65.78)
     HTML结构嵌套过深，表单复杂度过高
     缺少语义化标签，可访问性需改进
```

### PHP项目检测
```
🔍 开始嗅探：./my-php-app
📂 已找到文件数: 34 (包含 PHP: 28, HTML: 4, CSS: 2)

  🌸 屎山代码分析报告 🌸
─────────────────────────────

  总体评分: 38.92 / 100 - 略有异味，建议适量通风
  屎山等级: 屎气扑鼻 - 代码开始散发气味，谨慎维护

◆ 评分指标详情

  ✓  循环复杂度      22.15分   PHP控制结构基本合理
  ✓  状态管理        26.83分   类设计较为合理
  •  注释覆盖率      45.67分   缺少PHPDoc文档注释
  ⚠  错误处理        52.34分   异常处理需要完善
  !  代码重复度      58.91分   发现多个相似的CRUD方法
  !  命名规范        61.45分   部分变量命名不规范

◆ 最屎代码排行榜

  1. src/Controllers/UserController.php (屎气指数: 69.23)
     方法 'handleUserRegistration' 过长 (156 行)
     缺少适当的异常处理机制
     
  2. src/Models/User.php (屎气指数: 58.47)
     类复杂度较高，建议拆分职责
     缺少文档注释
```

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

### 开发指南

1. Fork 本仓库
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 打开 Pull Request

## 📄 开源协议

MIT License - 详见 [LICENSE](LICENSE) 文件

## 🙏 致谢

- 原版 Go 实现: [fuck-u-code](https://github.com/Done-0/fuck-u-code)
- 感谢所有贡献者和使用者

## ⚠️ 免责声明

本工具的评价结果仅供参考，旨在以幽默的方式帮助开发者发现代码中的潜在问题。请理性对待评分结果，持续改进代码质量。

记住：**没有完美的代码，只有不断进化的代码**。

---

### 🆕 新功能亮点

- ✨ **全新PHP支持**：完整支持PHP语法分析，包括类、方法、命名空间等
- 🎨 **前端文件检测**：HTML结构分析、CSS选择器复杂度、JavaScript DOM操作检测
- 🌱 **空项目检测**：即使是空文件夹也能给出有趣的分析报告
- 📊 **更智能的指标**：针对不同语言特点优化的质量评估算法
- 🔍 **更全面的覆盖**：支持更多文件扩展名和编程范式


现在你可以用一个工具分析从前端到后端的完整项目了！
